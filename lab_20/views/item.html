<!DOCTYPE html>
<html>

<head>
    <title>index</title>
</head>

<body>
    {{#with item}}
    <div>
        <div style="color: darkred" id="app_error"></div>
        <div>
            <label>id: </label>
            <input type="number" class="col-3" id="itemId" value="{{id}}" />
        </div>
        <br />
        <div>
            <label>name: </label>
            <input type="text" class="col-3" id="name" value="{{name}}" />
        </div>
        <br />
        <div>
            <label>amount: </label>
            <input type="number" class="col-3" id="amount" value="{{amount}}" />
        </div>
        <br />
        {{#with MeasureUnit}}
        <div>
            <label>measure unit: </label>
            <input type="text" class="col-3" id="shortName" value="{{shortName}}" />
        </div>
        {{/with}}
        <br />
        <div>
            <button onclick="Delete()">DELETE</button>
            <button onclick="Put()">PUT</button>
            <button onclick="Post()">POST</button>
        </div>
        <pre id="result" content=""></pre>
        <br />
    </div>
    {{/with}}
    <script>
        let result = document.getElementById('result')
        result.setAttribute('style', 'color: black')

        function Post() {
            let name = document.getElementById('name')
            let amount = document.getElementById('amount')
            let measureUnit = document.getElementById('shortName')

            let result = document.getElementById('result')
            result.setAttribute('style', 'color: black')

            let data = {
                name: name.value,
                amount: Number(amount.value),
                measureUnit: measureUnit.value,
            }

            console.log(data)
            fetch('/api/items', {
                method: 'POST',
                body: JSON.stringify(data),
                headers: {'Content-Type': 'application/json'},
            })
                .then((response) => {
                    if (response.ok == false) {
                        throw response.json()
                    }

                    return response.json()
                })
                .then((data) => {
                    result.innerHTML = JSON.stringify(data, null, '\t')
                })
                .catch((error) => {
                    result.setAttribute('style', 'color: red')
                    error.then((a) => {
                        result.innerHTML = JSON.stringify(a, null, '\t')
                    })
                })
        }

        function Delete() {
            let id = document.getElementById('id')
            result.setAttribute('style', 'color: black')

            fetch(`/api/item/${id.value}`, {
            method: 'DELETE',
            })
                .then((response) => {
                if (response.ok == false) {
                    throw response.json()
                }

                return response.json()
            })
            .then((data) => {
                result.innerHTML = JSON.stringify(data, null, '\t')
            })
            .catch((error) => {
                result.setAttribute('style', 'color: red')
                error.then((a) => {
                    result.innerHTML = JSON.stringify(a, null, '\t')
                })
            })
        }

        function Put() {
            let name = document.getElementById('name')
            let amount = document.getElementById('amount')
            let measureUnit = document.getElementById('shortName')
            let id = document.getElementById('itemId')

            result.setAttribute('style', 'color: black')

            let data = {
                name: name.value,
                amount: Number(amount.value),
                measureUnit: measureUnit.value,
            }

            console.log(data)
            fetch(`/api/items/${id.value}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data),
            })
                .then((response) => {
                    if (response.ok == false) {
                        throw response.json()
                    }

                    return response.json()
                })
                .then((data) => {
                    result.innerHTML = JSON.stringify(data, null, '\t')
                })
                .catch((error) => {
                    result.setAttribute('style', 'color: red')
                    error.then((a) => {
                        result.innerHTML = JSON.stringify(a, null, '\t')
                    })
                })
        }
    </script>
</body>
